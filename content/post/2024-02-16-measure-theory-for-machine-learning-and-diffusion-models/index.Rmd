---
title: Measure Theory for ML, AI and Diffusion Models
author: Mauro Camara Escudero
date: '2024-02-16'
slug: []
categories: []
tags: []
subtitle: 'A summary of measure theory required for machine learning and artificial intelligence.'
summary: 'Measure Theory for Machine Learning from Scratch'
authors: []
lastmod: '2024-02-16T13:46:31Z'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---
\usepackage{xcolor}
\usepackage{amsthm} 
\theoremstyle{definition}
\newtheorem{def}{Definition}[thm]
**Table of Contents**

- [Randomness, Mathematics, and Intuition](#randomness)
- [Sets and Measures](#sets-and-measures)

# Introduction
In this post, I will cover enough measure theory so that the reader will be able to understand the theory behind Denoising Diffusion Models, and more generally Machine Learning and Artificial Intelligence. To understand measure theory in full, a lot of background mathematical knowledge is required and inevitable, but I will try my best to make things intuitive and yet precise, while assuming **very few prerequisites**. Most importantly, I will always aim to show examples within Probability, Statistics, or Machine Learning, as to keep things on theme. After this post is complete, the plan is to make another one about Stochastic Calculus and SDEs for Machine Learning and Diffusion Models. 

If you find any mistake, typo or for anything else, don't hesitate to contact me. 

<a name="randomness"></a>

# Randomness, Mathematics, and Intuition
In everyday language, we sometimes use the expression "the probability of/that". For instance,

> The <span style="color:darkorange">probability</span> of <span style="color:deepskyblue">rolling a six</span> is <span style="color:#D81159">$1/6$</span>.

I have emphasized in three different colors the key components of that sentence. Measure theory can be used to define each of those three terms rigorously. Specifically, it can answer these questions:

1. What is a probability? (<span style="color:darkorange">orange</span> and <span style="color:#D81159">magenta</span>)
2. What "things" can have an associated probability? (<span style="color:deepskyblue">blue</span>)

All we need are **sets** and **functions**. 

## What this is all about
Until we have built enough measure theory to talk about machine learning, I will often talk about this very simple scenario: A person rolling a six-sided die and observing which number comes out on top. This is a classic and straightforward scenario considered in probability theory, but will allow me to talk about various notions in measure theory without getting lost in the details. I will assume:

- The die will *always* land with exactly one face up, meaning that it will never get stuck in any crack or height difference. Imagine the die is roll on an infinitely long and perfectly flat surface.
- The person will *always* be able to observe which number comes out on top.

Basically, I am making this super easy: the person rolls the die and observes either $1$, $2$, $3$, $4$, $5$, or $6$ written on top. This is known as an **experiment** in probability. I know, rolling a die is hardly an experiment, but the choice of this word is very fitting. It is called an experiment because, **before performing it, we do not know what the outcome of the experiment will be** (otherwise, if the die would always roll a $1$, we would not roll it and board games would be a lot less fun). 

Rolling a die and observing the number on top is just a specific "experiment". The concept of experiment is central to probability theory because whenever we talk about probabilities, we have in mind some sort of experiment, which will result in exactly one outcome, and we are interested in figuring out what is the probability of **some** of these outcomes. I say some because at times we are not interested in the probability of a single outcome, but in the probability of some outcomes. For instance, we may be interested in the probability of <span style="color:deepskyblue">rolling an even number</span>. As we will see soon, we can call **event** the collection of all the "outcomes" that we are interested in.

## Intuition behind probabilities
A probability of something happening is a numeric value that tells us how likely that something is to happen (if this seems circular, that's good, because it is). Ideally, we would like to have a **maximum** probability value for things that are **certain** and a **minimum** probability value for things that are **impossible**. We could choose any two values, but historically, mathematicians have settled for $1$ and $0$ respectively. It makes sense to construct a **function** that takes a "thing" as input and outputs the probability of that thing happening, which is a value in $[0, 1]$.

## Intuition behind events
What "things" can we assign a probability to? Imagine that measure theory has not been developed yet and you find yourself wanting to write the statement above mathematically. What mathematical object can represent the words <span style="color:deepskyblue">rolling a six</span>? A first attempt could be to set it to the number six
$$
\underbrace{\textcolor{deepskyblue}{\text{rolling a six}}}_{\text{everyday language}} = \underbrace{6}_{\text{mathematics}}
$$
This approach doesn't seem to bad because it works seamlessly for other numbers, for instance "rolling a one" would simply be $1$ and so on. However, this approach breaks down when we consider more complicated expressions, for instance, it is not clear how one should "encode"

> Rolling an even number (i.e. either 2, 4, or 6)

using this convention. There are infinitely many natural numbers, so one could potentially encode this and many more complicated expressions for larger and larger numbers. For instance, <span style="color:deepskyblue">rolling an even number</span> could be represented as $7$, and <span style="color:deepskyblue">rolling an odd number</span> could be represented as $8$. There are various issues with this approach, but perhaps the most intuitive to understand is that this way we would have to manually encode each "thing" into a number. Thankfully, there is a better approach.

After attempting to represents "things" with numbers, one may switch to sets. Consider again the task of rolling a six-sided die and observing which number comes on top. We assume that the die cannot get stuck anywhere and always lands on one face or the other, and that we can always observe the number on top. The possible outcomes of this task are that we observe $1$, $2$, $3$, $4$, $5$, or $6$. No other outcome is possible. The phrase <span style="color:deepskyblue">rolling a six</span> could then be encoded as a set
$$
\underbrace{\textcolor{deepskyblue}{\text{rolling a six}}}_{\text{everyday language}} = \underbrace{\{6\}}_{\text{mathematics}}.
$$
You may think that we have not improved the situation by much, since in this set there is only a single element (we say $\{6\}$ is a singleton set). However, this makes talking about more complex "things" a lot easier. For instance, <span style="color:deepskyblue">rolling an even number</span> can be represented by the set containing all the even numbers, and similarly for <span style="color:deepskyblue">rolling an odd number</span>
$$
\underbrace{\textcolor{deepskyblue}{\text{rolling an even number}}}_{\text{everyday language}} = \underbrace{\{2, 4, 6\}}_{\text{mathematics}}.
$$
Sometimes in board games you will need to roll a number above a certain value. This can also be represented easily, for instance 
$$
\underbrace{\textcolor{deepskyblue}{\text{rolling a number larger than three}}}_{\text{everyday language}} = \underbrace{\{4, 5, 6\}}_{\text{mathematics}}.
$$
It turns out, sets are **very flexible** and a great candidate to represent "things" that we want to assign a probability to. Speaking of, all the phrases I have colored in <span style="color:deepskyblue">blue</span> are called **events**. 

> If we can talk about the probability of "something" happening, that something is known as an **event**.

Something that may come as a shock, is that not every set is an event. There are sets for which we cannot talk about their "probability", we will talk more about that later. 

## Intuition behind relationship of probabilities and events
Okay, we can represent events as sets and it seems to be a sensible choice. Now, what does it mean that a certain event has a probability? We need to define the **probability function**. As we expect, this should take *sets* as inputs and return a value between $0$ and $1$, the higher the value, the more likely the event represented by the set, is to happen. Since the function takes sets as inputs, one may think that its domain is the *power set of all possible outcomes*. In other words, if we collect together all outcomes into a single set, which we call the **sample space**
$$
\Omega := \left\{1, 2, 3, 4, 5, 6\right\}
$$
then an event is any subset $\mathsf{E}\subseteq \Omega$. It turns out that when we have finitely many possible outcomes (such as in the die example) this is true, but when we have infinitely many, not all subsets are valid events. In either case, we call **event space** the set of all valid events. By definition, we know that this is a set whose elements are subsets of $\Omega$, but not necessarily *all* subsets. Typically, the event space is denoted by $\mathcal{F}$. In our six-sided die example, $\mathcal{F}$ contains all the subsets (since $\Omega$ has finitely many elements)
$$
\mathcal{F} = 2^\Omega.
$$
For example, $\{2, 4, 6\}\in\mathcal{F}$.

<a name="sets-and-measures"><a/>

# Sigma Algebras

> **Sigma Algebra**: Let $\mathsf{X}$ be a non-empty set. A set $\mathcal{X}\subseteq \mathcal{P}(\mathsf{X})$ is a sigma algebra over $\mathsf{X}$ if it satisfies:\
1. $\mathsf{X}\in\mathcal{X}$ \
2. Closure under the complementation operation
$$
\mathsf{A}\in\mathcal{X} \implies \mathsf{X}\backslash\mathsf{A} \in\mathcal{X}
$$
3. Closure under countable unions
$$
\mathsf{A}_i \in \mathcal{X} \,\,\,\,\,\forall\, i\in\mathcal{I}, \text{ with }|\mathcal{I}|\leq \aleph_0 \implies \bigcup_{i\in\mathcal{I}} \mathsf{A}_i \in\mathcal{X}
$$

> **Sub-Sigma Algebras**: Let $\mathsf{X}$ be a set and $\mathcal{X}$ and $\mathcal{X}'$ be two sigma algebras on it. If $\mathcal{X}'\subseteq \mathcal{X}$ then we call $\mathcal{X}'$ a sub-sigma algebra of $\mathcal{X}$.

> **Intersection of Sigma Algebras**: Let $\mathsf{X}$ be a non-empty set, $\mathcal{I}$ be *any* set and $\{\mathcal{X}_i\,:\, i\in\mathcal{I}\}$ be a collection of sigma algebras on $\mathsf{X}$. The intersection of these sigma algebras
$$
\bigcap_{i\in\mathcal{I}} \mathcal{X}_i 
$$
is a sigma algebra over $\mathsf{X}$.

> **Sigma algebra generated by a collection of sets**: Let $\mathsf{X}$ be a non-empty set and $\mathcal{C}$ be a collection of subsets of $\mathsf{X}$. Then the collection $\mathcal{C}$ induces a sigma algebra on $\mathsf{X}$, which we call the sigma algebra generated by $\mathcal{C}$, and denote $\sigma(\mathcal{C})$. This sigma algebra is the intersection of all sigma algebras containing $\mathcal{C}$
$$
\sigma(\mathcal{C}) = \bigcap_{\substack{\mathcal{C}\in\mathcal{X} \\\text{sigma algebra}}} \mathcal{X}
$$
and it is the *smallest* sigma algebra containing $\mathcal{C}$.

>**Measurable Space**: Let $\mathsf{X}$ be a non-empty set and $\mathcal{X}\subset\mathcal{P}(\mathsf{X})$ be a sigma algebra on it. The pair $(\mathsf{X}, \mathcal{X})$ is called a measurable space, and any set $\mathsf{A}\in\mathcal{X}$ is called $\mathcal{X}$-measurable.

# Measures

> **Measure**: Let $(\mathsf{X}, \mathcal{X})$ be a measurable space. A function $\mu:\mathcal{X}\to [0, +\infty]$ is called a measure if it satisfies \
1. $\mu(\emptyset) = 0$ \
2. Countable additivity: If $\{\mathsf{A}_i\,:\,i\in\mathcal{I}\}$ with $|\mathcal{I}|\leq \aleph_0$ is a countable collection of *pairwise disjoint* sets then
$$
\mu\left(\bigcup_{i\in\mathcal{I}} \mathsf{A}_i\right) = \sum_{i\in\mathcal{I}} \mu(\mathsf{A}_i)
$$

> **Measure Space**: A triplet $(\mathsf{X}, \mathcal{X}, \mu)$ is called a measure space if $\mu$ is a measure on the measurable space $(\mathsf{X}, \mathcal{X})$.

> **Finite Measure**: Let $(\mathsf{X}, \mathcal{X}, \mu)$ be a measure space. We say $\mu$ is *finite* if $\mu(\mathsf{X}) < \infty$. We say $\mu$ is $\sigma$-finite if there exists a countable partition $\{\mathsf{X}_n\,:\, n\in\mathbb{N}\}$ of $\mathsf{X}$ (meaning they are mutually disjoint and their union covers all of $\mathsf{X}$) such that $\mu(\mathsf{X}_n) < \infty$ for each $n\in\mathsf{N}$. 

> **Probability Measure**: Let $(\mathsf{X}, \mathcal{X}, \mu)$ be a measurable space with $\mu$ being a finite measure. If $\mu(\mathsf{X}) = 1$ we say that $\mu$ is a probability measure. Notice that given any finite measure $\nu$, one can define a corresponding probability measure by normalization $\mu = \nu / \nu(\mathsf{X})$.

# Random Variables and Distributions

> **Random Variable**: Let $(\Omega, \mathcal{F})$ and $(\mathsf{X}, \mathcal{X})$ be two measurable spaces. A function $\mathrm{X}:\Omega\to\mathsf{X}$ is $\mathcal{F}$-measurable if for every set $\mathsf{B}\in\mathcal{X}$ its preimage $\mathrm{X}^{-1}(\mathsf{B})$ is $\mathcal{F}$-measurable
$$
\mathrm{X}^{-1}(\mathsf{B}) \in\mathcal{F} \qquad\forall\, \mathsf{B}\in\mathcal{X}.
$$
If $(\Omega, \mathcal{F}, \mathbb{P})$ is a probability space, then the $\mathcal{X}$-measurable function $\mathrm{X}$ is called a random variable.

> **Distribution**: Let $(\Omega, \mathcal{F}, \mathbb{P})$ be a probability space, $(\mathsf{X}, \mathcal{X})$ be a measurable space and $\mathrm{X}:\Omega\to\mathsf{X}$ be a random variable. Then $\mathsf{X}$ induces a probability measure on $(\mathsf{X}, \mathcal{X})$, called the (probability) distribution of $\mathrm{X}$ and defined as the *pushforward* of $\mathbb{P}$ by $\mathrm{X}$
$$
\mathbb{P}^\mathrm{X} := \mathbb{P}\circ\mathrm{X}^{-1}.
$$
For any measurable set $\mathsf{A}\in\mathcal{X}$ we write $\mathbb{P}^{\mathrm{X}}(\mathsf{A}) = \mathbb{P}(\mathrm{X}^{-1}(\mathsf{A})) = \mathbb{P}(\mathrm{X}\in\mathsf{A})$.

> **Sigma Algebra generated by a function**: Let $(\mathsf{Y}, \mathcal{Y})$ be a measurable space, $\mathsf{X}$ be a non-empty set and $f:\mathsf{X}\to\mathsf{Y}$ be a function (not necessarily measurable). Then $f$ induces a sigma algebra on $\mathsf{X}$, denoted $\sigma(f)$ 
$$
\sigma(f) := \left\{f^{-1}(\mathsf{A})\,:\, \mathsf{A}\in\mathcal{Y}\right\},
$$
which is the *smallest* sigma algebra on $\mathsf{X}$ such that $f$ is measurable relative to it, indeed by definition $f$ is $\sigma(f)$-measurable. Therefor one could write $\sigma(f) = \sigma\left(\left\{f^{-1}(\mathsf{A})\,:\, \mathsf{A}\in\mathcal{Y}\right\}\right)$.

# $\pi$-Systems and $\lambda$-Systems

> **$\pi$-system**: Let $\mathsf{P}$ be a non-empty set that is closed under finite intersections, meaning that if $\mathsf{A}, \mathsf{B}\in\mathsf{P}$ then $\mathsf{A}\cap\mathsf{B} \in \mathsf{P}$ and by induction for any $n\in\mathbb{N}$ we have
$$
\bigcap_{i=1}^n \mathsf{A}_i \in \mathsf{P} \qquad \text{ where } \mathsf{A}_i\in\mathsf{P} \,\,\forall\, i=1, \ldots, n
$$

> **$\pi$-system over a set**: Let $\mathsf{X}$ be a non-empty set and $\mathsf{P}\subseteq \mathcal{P}(\mathsf{X})$ be a $\pi$-system whose elements are all subsets of $\mathsf{X}$. Then $\mathsf{P}$ is a $\pi$-system over $\mathsf{X}$.

Of course, since $\mathsf{P}$ is a collection of subsets of $\mathsf{X}$, one can use it to generate a sigma algebra, $\sigma(\mathsf{P})$ over $\mathsf{X}$.

> **$\lambda$-system over a set**: Let $\mathsf{X}$ be a non-empty set and $\mathcal{L}\subseteq \mathcal{P}(\mathsf{X})$ be a collection of subsets of $\mathsf{X}$. Then $\mathsf{L}$ is a $\lambda$-system if \
1. Contains $\mathsf{X}$: $\mathsf{X}\in\mathsf{L}$ \
2. Closed under complementation: $\mathsf{A}\in\mathsf{L} \implies \mathsf{X} \backslash \mathsf{A} \in \mathsf{L}$. \
3. Closed under countable *disjoint* unions: If $\mathsf{A}_i \in \mathsf{L}$ for $i\in\mathcal{I}$ with $|\mathcal{I}|\leq \aleph_0$ and $A_i \cap A_j = \emptyset$ for $i \neq j$ then
$$
\bigcup_{i\in\mathcal{I}} \mathsf{A}_i \in \mathsf{L}.
$$

Importantly, if $\mathcal{S}$ is both a $\pi$-system and a $\lambda$-system over the non-empty set $\mathsf{X}$, then automatically $\mathcal{S}$ is a sigma-algebra over $\mathsf{X}$. The next theorem, tells us that the sigma algebra generated by a $\pi$-system that is strictly contained inside a $\lambda$-system, is itself strictly contained into the very same $\lambda$-system.

> **$\pi$-$\lambda$ theorem**: Let $\mathsf{X}$ be a non-empty set, $\mathsf{P}\subset\mathsf{L}$ be a $\pi$-system and a $\lambda$-system over $\mathsf{X}$ respectively, then $\sigma(\mathsf{P}) \subset \mathsf{L}$.

The usefulness of this theorem is that if two probability measures agree on a $\pi$-system, then these measures agree on the sigma algebra generated by it.

> **Uniqueness of measures on $\pi$-system**: Let $\mathbb{P}$ and $\mathbb{Q}$ be two probability measures on $(\mathsf{X}, \sigma(\mathsf{P}))$, where $\mathsf{P}$ is a $\pi$-system over $\mathsf{X}$. Then
$$
\mathbb{P}(\mathsf{A}) = \mathbb{Q}(\mathsf{A}) \,\,\, \forall\,\mathsf{A}\in\mathsf{P} \implies \mathbb{P}(\mathsf{A}) = \mathbb{Q}(\mathsf{A}) \,\,\,\forall\, \mathsf{A}\in\sigma(\mathsf{P}).
$$

An important application of this is used to motivate the fact that two random variables are *equal in distribution* whenever they have the same cumulative distribution function. We express this below

> **Same CDF implies same distribution**: Let $(\Omega, \mathcal{F}, \mathbb{P})$ be a probability space, $(\mathsf{X}, \mathcal{X})$ be a measurable space with $(\mathsf{X}, \leq)$ being totally ordered, and $\mathrm{X}_1, \mathrm{X}_2:\Omega\to \mathsf{X}$ be two random variables with distributions $\mathbb{P}^{\mathrm{X}_1}$ and $\mathbb{P}^{\mathrm{X}_2}$ respectively. Then the collection of sets
$$
\mathsf{P} := \left\{ \{y\in\mathsf{X} \, : \, y\leq x\} \,:\, x\in\mathsf{X}\right\}
$$
forms a $\pi$-system, and if we define the Cumulative Distribution Function (CDF) as
$$
\mathrm{F}_{\mathrm{X}_i}(x) := \mathbb{P}_{\mathrm{X}_i}\left(\{y\in\mathsf{X}\,:\,y\leq x\}\right) = \mathbb{P}\left(\left\{\omega\in\Omega\,:\, \mathrm{X}_i(\omega) \leq x\right\}\right) =: \mathbb{P}(\mathrm{X}_i \leq x) \qquad \forall\, x\in\mathsf{X}, \,\, i=1,2,
$$
then by the $\pi$-$\lambda$ theorem, if $\mathrm{X}_1$ and $\mathrm{X}_2$ have the same CDFs, then $\mathbb{P}^{\mathrm{X}_1}$ and $\mathbb{P}^{\mathrm{X}_2}$ agree on the $\pi$-system described above and thus they also agree on $\sigma(\mathsf{P})$. Therefore, as long as we choose $\mathcal{X} \equiv \sigma(\mathsf{P})$ then we are done.

# Stochastic Processes

> **Filtration**: Let $(\Omega, \mathcal{F}, \mathbb{P})$ be a probability space, and $(\mathsf{T}, \leq)$ be a totally-ordered set, which we call an index set. A filtration $\{\mathcal{F}_t\,:\, t\in\mathsf{T}\}$ induced by $(\mathsf{T}, \leq)$ is a collection of sub-sigma algebras of $\mathcal{F}$ such that $\mathcal{F}_q\subseteq\mathcal{F}_s$ when $q\leq s$.

> **Stochastic Process**: Let $(\Omega, \mathcal{F}, \mathbb{P})$ be a probability space, $(\mathsf{X}, \mathcal{X})$ be a measurable space, and $(\mathsf{T}, \leq)$ be any totally-ordered set. The collection $\{\mathrm{X}_t\,:\, t\in\mathsf{T}\}$ of random variables $\mathrm{X}_t:\Omega\to\mathsf{X}$ is called a stochastic process. If $\mathsf{T}$ is uncountable, then it is a continuous-time stochastic process, if $\mathsf{T}$ is countable then it is a discrete-time stochastic process.

> **Path**: For $\omega\in\Omega$ **fixed** then $t\mapsto \mathrm{X}_t(\omega)$ is a function which we call the path of $\mathrm{X}_t$. 

In fact, to each $\omega\in\Omega$ there corresponds a function $t\mapsto \mathrm{X}_t(\omega)$, so that we can put $\Omega$ on a one-to-one correspondence with the space $\mathsf{X}^\mathsf{T}$ of functions from $\mathsf{T}$ to $\mathsf{X}$.






