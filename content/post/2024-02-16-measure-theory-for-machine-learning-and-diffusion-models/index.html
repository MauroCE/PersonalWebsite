---
title: Measure Theory for ML, AI and Diffusion Models
author: Mauro Camara Escudero
date: '2024-02-16'
slug: []
categories: []
tags: []
subtitle: 'A summary of measure theory required for machine learning and artificial intelligence.'
summary: 'Measure Theory for Machine Learning from Scratch'
authors: []
lastmod: '2024-02-16T13:46:31Z'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



<p><strong>Table of Contents</strong></p>
<ul>
<li><a href="#randomness">Randomness, Mathematics, and Intuition</a></li>
<li><a href="#sets-and-measures">Sets and Measures</a></li>
</ul>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>In this post, I will cover enough measure theory so that the reader will be able to understand the theory behind Denoising Diffusion Models, and more generally Machine Learning and Artificial Intelligence. To understand measure theory in full, a lot of background mathematical knowledge is required and inevitable, but I will try my best to make things intuitive and yet precise, while assuming <strong>very few prerequisites</strong>. Most importantly, I will always aim to show examples within Probability, Statistics, or Machine Learning, as to keep things on theme. After this post is complete, the plan is to make another one about Stochastic Calculus and SDEs for Machine Learning and Diffusion Models.</p>
<p>If you find any mistake, typo or for anything else, don’t hesitate to contact me.</p>
<p><a name="randomness"></a></p>
</div>
<div id="randomness-mathematics-and-intuition" class="section level1">
<h1>Randomness, Mathematics, and Intuition</h1>
<p>In everyday language, we sometimes use the expression “the probability of/that”. For instance,</p>
<blockquote>
<p>The <span style="color:darkorange">probability</span> of <span style="color:deepskyblue">rolling a six</span> is <span style="color:#D81159"><span class="math inline">\(1/6\)</span></span>.</p>
</blockquote>
<p>I have emphasized in three different colors the key components of that sentence. Measure theory can be used to define each of those three terms rigorously. Specifically, it can answer these questions:</p>
<ol style="list-style-type: decimal">
<li>What is a probability? (<span style="color:darkorange">orange</span> and <span style="color:#D81159">magenta</span>)</li>
<li>What “things” can have an associated probability? (<span style="color:deepskyblue">blue</span>)</li>
</ol>
<p>All we need are <strong>sets</strong> and <strong>functions</strong>.</p>
<div id="what-this-is-all-about" class="section level2">
<h2>What this is all about</h2>
<p>Until we have built enough measure theory to talk about machine learning, I will often talk about this very simple scenario: A person rolling a six-sided die and observing which number comes out on top. This is a classic and straightforward scenario considered in probability theory, but will allow me to talk about various notions in measure theory without getting lost in the details. I will assume:</p>
<ul>
<li>The die will <em>always</em> land with exactly one face up, meaning that it will never get stuck in any crack or height difference. Imagine the die is roll on an infinitely long and perfectly flat surface.</li>
<li>The person will <em>always</em> be able to observe which number comes out on top.</li>
</ul>
<p>Basically, I am making this super easy: the person rolls the die and observes either <span class="math inline">\(1\)</span>, <span class="math inline">\(2\)</span>, <span class="math inline">\(3\)</span>, <span class="math inline">\(4\)</span>, <span class="math inline">\(5\)</span>, or <span class="math inline">\(6\)</span> written on top. This is known as an <strong>experiment</strong> in probability. I know, rolling a die is hardly an experiment, but the choice of this word is very fitting. It is called an experiment because, <strong>before performing it, we do not know what the outcome of the experiment will be</strong> (otherwise, if the die would always roll a <span class="math inline">\(1\)</span>, we would not roll it and board games would be a lot less fun).</p>
<p>Rolling a die and observing the number on top is just a specific “experiment”. The concept of experiment is central to probability theory because whenever we talk about probabilities, we have in mind some sort of experiment, which will result in exactly one outcome, and we are interested in figuring out what is the probability of <strong>some</strong> of these outcomes. I say some because at times we are not interested in the probability of a single outcome, but in the probability of some outcomes. For instance, we may be interested in the probability of <span style="color:deepskyblue">rolling an even number</span>. As we will see soon, we can call <strong>event</strong> the collection of all the “outcomes” that we are interested in.</p>
</div>
<div id="intuition-behind-probabilities" class="section level2">
<h2>Intuition behind probabilities</h2>
<p>A probability of something happening is a numeric value that tells us how likely that something is to happen (if this seems circular, that’s good, because it is). Ideally, we would like to have a <strong>maximum</strong> probability value for things that are <strong>certain</strong> and a <strong>minimum</strong> probability value for things that are <strong>impossible</strong>. We could choose any two values, but historically, mathematicians have settled for <span class="math inline">\(1\)</span> and <span class="math inline">\(0\)</span> respectively. It makes sense to construct a <strong>function</strong> that takes a “thing” as input and outputs the probability of that thing happening, which is a value in <span class="math inline">\([0, 1]\)</span>.</p>
</div>
<div id="intuition-behind-events" class="section level2">
<h2>Intuition behind events</h2>
<p>What “things” can we assign a probability to? Imagine that measure theory has not been developed yet and you find yourself wanting to write the statement above mathematically. What mathematical object can represent the words <span style="color:deepskyblue">rolling a six</span>? A first attempt could be to set it to the number six
<span class="math display">\[
\underbrace{\textcolor{deepskyblue}{\text{rolling a six}}}_{\text{everyday language}} = \underbrace{6}_{\text{mathematics}}
\]</span>
This approach doesn’t seem to bad because it works seamlessly for other numbers, for instance “rolling a one” would simply be <span class="math inline">\(1\)</span> and so on. However, this approach breaks down when we consider more complicated expressions, for instance, it is not clear how one should “encode”</p>
<blockquote>
<p>Rolling an even number (i.e. either 2, 4, or 6)</p>
</blockquote>
<p>using this convention. There are infinitely many natural numbers, so one could potentially encode this and many more complicated expressions for larger and larger numbers. For instance, <span style="color:deepskyblue">rolling an even number</span> could be represented as <span class="math inline">\(7\)</span>, and <span style="color:deepskyblue">rolling an odd number</span> could be represented as <span class="math inline">\(8\)</span>. There are various issues with this approach, but perhaps the most intuitive to understand is that this way we would have to manually encode each “thing” into a number. Thankfully, there is a better approach.</p>
<p>After attempting to represents “things” with numbers, one may switch to sets. Consider again the task of rolling a six-sided die and observing which number comes on top. We assume that the die cannot get stuck anywhere and always lands on one face or the other, and that we can always observe the number on top. The possible outcomes of this task are that we observe <span class="math inline">\(1\)</span>, <span class="math inline">\(2\)</span>, <span class="math inline">\(3\)</span>, <span class="math inline">\(4\)</span>, <span class="math inline">\(5\)</span>, or <span class="math inline">\(6\)</span>. No other outcome is possible. The phrase <span style="color:deepskyblue">rolling a six</span> could then be encoded as a set
<span class="math display">\[
\underbrace{\textcolor{deepskyblue}{\text{rolling a six}}}_{\text{everyday language}} = \underbrace{\{6\}}_{\text{mathematics}}.
\]</span>
You may think that we have not improved the situation by much, since in this set there is only a single element (we say <span class="math inline">\(\{6\}\)</span> is a singleton set). However, this makes talking about more complex “things” a lot easier. For instance, <span style="color:deepskyblue">rolling an even number</span> can be represented by the set containing all the even numbers, and similarly for <span style="color:deepskyblue">rolling an odd number</span>
<span class="math display">\[
\underbrace{\textcolor{deepskyblue}{\text{rolling an even number}}}_{\text{everyday language}} = \underbrace{\{2, 4, 6\}}_{\text{mathematics}}.
\]</span>
Sometimes in board games you will need to roll a number above a certain value. This can also be represented easily, for instance
<span class="math display">\[
\underbrace{\textcolor{deepskyblue}{\text{rolling a number larger than three}}}_{\text{everyday language}} = \underbrace{\{4, 5, 6\}}_{\text{mathematics}}.
\]</span>
It turns out, sets are <strong>very flexible</strong> and a great candidate to represent “things” that we want to assign a probability to. Speaking of, all the phrases I have colored in <span style="color:deepskyblue">blue</span> are called <strong>events</strong>.</p>
<blockquote>
<p>If we can talk about the probability of “something” happening, that something is known as an <strong>event</strong>.</p>
</blockquote>
<p>Something that may come as a shock, is that not every set is an event. There are sets for which we cannot talk about their “probability”, we will talk more about that later.</p>
</div>
<div id="intuition-behind-relationship-of-probabilities-and-events" class="section level2">
<h2>Intuition behind relationship of probabilities and events</h2>
<p>Okay, we can represent events as sets and it seems to be a sensible choice. Now, what does it mean that a certain event has a probability? We need to define the <strong>probability function</strong>. As we expect, this should take <em>sets</em> as inputs and return a value between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>, the higher the value, the more likely the event represented by the set, is to happen. Since the function takes sets as inputs, one may think that its domain is the <em>power set of all possible outcomes</em>. In other words, if we collect together all outcomes into a single set, which we call the <strong>sample space</strong>
<span class="math display">\[
\Omega := \left\{1, 2, 3, 4, 5, 6\right\}
\]</span>
then an event is any subset <span class="math inline">\(\mathsf{E}\subseteq \Omega\)</span>. It turns out that when we have finitely many possible outcomes (such as in the die example) this is true, but when we have infinitely many, not all subsets are valid events. In either case, we call <strong>event space</strong> the set of all valid events. By definition, we know that this is a set whose elements are subsets of <span class="math inline">\(\Omega\)</span>, but not necessarily <em>all</em> subsets. Typically, the event space is denoted by <span class="math inline">\(\mathcal{F}\)</span>. In our six-sided die example, <span class="math inline">\(\mathcal{F}\)</span> contains all the subsets (since <span class="math inline">\(\Omega\)</span> has finitely many elements)
<span class="math display">\[
\mathcal{F} = 2^\Omega.
\]</span>
For example, <span class="math inline">\(\{2, 4, 6\}\in\mathcal{F}\)</span>.</p>
<p><a name="sets-and-measures"><a/></p>
</div>
</div>
<div id="sets-and-measures" class="section level1">
<h1>Sets and Measures</h1>
<blockquote>
<p><strong>Sigma Algebra</strong>: Let <span class="math inline">\(\mathsf{X}\)</span> be a non-empty set. A set <span class="math inline">\(\mathcal{X}\subseteq \mathcal{P}(\mathsf{X})\)</span> is a sigma algebra over <span class="math inline">\(\mathsf{X}\)</span> if it satisfies:<br />
1. <span class="math inline">\(\mathsf{X}\in\mathcal{X}\)</span><br />
2. Closure under the complementation operation
<span class="math display">\[
\mathsf{A}\in\mathcal{X} \implies \mathsf{X}\backslash\mathsf{A} \in\mathcal{X}
\]</span>
3. Closure under countable unions
<span class="math display">\[
\mathsf{A}_i \in \mathcal{X} \,\,\,\,\,\forall\, i\in\mathcal{I}, \text{ with }|\mathcal{I}|\leq \aleph_0 \implies \bigcup_{i\in\mathcal{I}} \mathsf{A}_i \in\mathcal{X}
\]</span></p>
</blockquote>
<blockquote>
<p><strong>Sub-Sigma Algebras</strong>: Let <span class="math inline">\(\mathsf{X}\)</span> be a set and <span class="math inline">\(\mathcal{X}\)</span> and <span class="math inline">\(\mathcal{X}&#39;\)</span> be two sigma algebras on it. If <span class="math inline">\(\mathcal{X}&#39;\subseteq \mathcal{X}\)</span> then we call <span class="math inline">\(\mathcal{X}&#39;\)</span> a sub-sigma algebra of <span class="math inline">\(\mathcal{X}\)</span>.</p>
</blockquote>
<blockquote>
<p><strong>Measurable Space</strong>: Let <span class="math inline">\(\mathsf{X}\)</span> be a non-empty set and <span class="math inline">\(\mathcal{X}\subset\mathcal{P}(\mathsf{X})\)</span> be a sigma algebra on it. The pair <span class="math inline">\((\mathsf{X}, \mathcal{X})\)</span> is called a measurable space, and any set <span class="math inline">\(\mathsf{A}\in\mathcal{X}\)</span> is called <span class="math inline">\(\mathcal{X}\)</span>-measurable.</p>
</blockquote>
<blockquote>
<p><strong>Measure</strong>: Let <span class="math inline">\((\mathsf{X}, \mathcal{X})\)</span> be a measurable space. A function <span class="math inline">\(\mu:\mathcal{X}\to [0, +\infty]\)</span> is called a measure if it satisfies<br />
1. <span class="math inline">\(\mu(\emptyset) = 0\)</span><br />
2. Countable additivity: If <span class="math inline">\(\{\mathsf{A}_i\,:\,i\in\mathcal{I}\}\)</span> with <span class="math inline">\(|\mathcal{I}|\leq \aleph_0\)</span> is a countable collection of <em>pairwise disjoint</em> sets then
<span class="math display">\[
\mu\left(\bigcup_{i\in\mathcal{I}} \mathsf{A}_i\right) = \sum_{i\in\mathcal{I}} \mu(\mathsf{A}_i)
\]</span></p>
</blockquote>
<blockquote>
<p><strong>Measure Space</strong>: A triplet <span class="math inline">\((\mathsf{X}, \mathcal{X}, \mu)\)</span> is called a measure space if <span class="math inline">\(\mu\)</span> is a measure on the measurable space <span class="math inline">\((\mathsf{X}, \mathcal{X})\)</span>.</p>
</blockquote>
<blockquote>
<p><strong>Finite Measure</strong>: Let <span class="math inline">\((\mathsf{X}, \mathcal{X}, \mu)\)</span> be a measure space. We say <span class="math inline">\(\mu\)</span> is <em>finite</em> if <span class="math inline">\(\mu(\mathsf{X}) &lt; \infty\)</span>. We say <span class="math inline">\(\mu\)</span> is <span class="math inline">\(\sigma\)</span>-finite if there exists a countable partition <span class="math inline">\(\{\mathsf{X}_n\,:\, n\in\mathbb{N}\}\)</span> of <span class="math inline">\(\mathsf{X}\)</span> (meaning they are mutually disjoint and their union covers all of <span class="math inline">\(\mathsf{X}\)</span>) such that <span class="math inline">\(\mu(\mathsf{X}_n) &lt; \infty\)</span> for each <span class="math inline">\(n\in\mathsf{N}\)</span>.</p>
</blockquote>
<blockquote>
<p><strong>Probability Measure</strong>: Let <span class="math inline">\((\mathsf{X}, \mathcal{X}, \mu)\)</span> be a measurable space with <span class="math inline">\(\mu\)</span> being a finite measure. If <span class="math inline">\(\mu(\mathsf{X}) = 1\)</span> we say that <span class="math inline">\(\mu\)</span> is a probability measure. Notice that given any finite measure <span class="math inline">\(\nu\)</span>, one can define a corresponding probability measure by normalization <span class="math inline">\(\mu = \nu / \nu(\mathsf{X})\)</span>.</p>
</blockquote>
</div>
<div id="random-variables-and-distributions" class="section level1">
<h1>Random Variables and Distributions</h1>
<blockquote>
<p><strong>Random Variable</strong>: Let <span class="math inline">\((\Omega, \mathcal{F})\)</span> and <span class="math inline">\((\mathsf{X}, \mathcal{X})\)</span> be two measurable spaces. A function <span class="math inline">\(\mathrm{X}:\Omega\to\mathsf{X}\)</span> is <span class="math inline">\(\mathcal{F}\)</span>-measurable if for every set <span class="math inline">\(\mathsf{B}\in\mathcal{X}\)</span> its preimage <span class="math inline">\(\mathrm{X}^{-1}(\mathsf{B})\)</span> is <span class="math inline">\(\mathcal{F}\)</span>-measurable
<span class="math display">\[
\mathrm{X}^{-1}(\mathsf{B}) \in\mathcal{F} \qquad\forall\, \mathsf{B}\in\mathcal{X}.
\]</span>
If <span class="math inline">\((\Omega, \mathcal{F}, \mathbb{P})\)</span> is a probability space, then the <span class="math inline">\(\mathcal{X}\)</span>-measurable function <span class="math inline">\(\mathrm{X}\)</span> is called a random variable.</p>
</blockquote>
<blockquote>
<p><strong>Distribution</strong>: Let <span class="math inline">\((\Omega, \mathcal{F}, \mathbb{P})\)</span> be a probability space, <span class="math inline">\((\mathsf{X}, \mathcal{X})\)</span> be a measurable space and <span class="math inline">\(\mathrm{X}:\Omega\to\mathsf{X}\)</span> be a random variable. Then <span class="math inline">\(\mathsf{X}\)</span> induces a probability measure on <span class="math inline">\((\mathsf{X}, \mathcal{X})\)</span>, called the (probability) distribution of <span class="math inline">\(\mathrm{X}\)</span> and defined as the <em>pushforward</em> of <span class="math inline">\(\mathbb{P}\)</span> by <span class="math inline">\(\mathrm{X}\)</span>
<span class="math display">\[
\mathbb{P}^\mathrm{X} := \mathbb{P}\circ\mathrm{X}^{-1}.
\]</span>
For any measurable set <span class="math inline">\(\mathsf{A}\in\mathcal{X}\)</span> we write <span class="math inline">\(\mathbb{P}^{\mathrm{X}}(\mathsf{A}) = \mathbb{P}(\mathrm{X}^{-1}(\mathsf{A})) = \mathbb{P}(\mathrm{X}\in\mathsf{A})\)</span>.</p>
</blockquote>
</div>
<div id="stochastic-processes" class="section level1">
<h1>Stochastic Processes</h1>
<blockquote>
<p><strong>Filtration</strong>: Let <span class="math inline">\((\Omega, \mathcal{F}, \mathbb{P})\)</span> be a probability space, and <span class="math inline">\((\mathsf{T}, \leq)\)</span> be a totally-ordered set, which we call an index set. A filtration <span class="math inline">\(\{\mathcal{F}_t\,:\, t\in\mathsf{T}\}\)</span> induced by <span class="math inline">\((\mathsf{T}, \leq)\)</span> is a collection of sub-sigma algebras of <span class="math inline">\(\mathcal{F}\)</span> such that <span class="math inline">\(\mathcal{F}_q\subseteq\mathcal{F}_s\)</span> when <span class="math inline">\(q\leq s\)</span>.</p>
</blockquote>
<blockquote>
<p><strong>Stochastic Process</strong>: Let <span class="math inline">\((\Omega, \mathcal{F}, \mathbb{P})\)</span> be a probability space, <span class="math inline">\((\mathsf{X}, \mathcal{X})\)</span> be a measurable space, and <span class="math inline">\((\mathsf{T}, \leq)\)</span> be any totally-ordered set. The collection <span class="math inline">\(\{\mathrm{X}_t\,:\, t\in\mathsf{T}\}\)</span> of random variables <span class="math inline">\(\mathrm{X}_t:\Omega\to\mathsf{X}\)</span> is called a stochastic process. If <span class="math inline">\(\mathsf{T}\)</span> is uncountable, then it is a continuous-time stochastic process, if <span class="math inline">\(\mathsf{T}\)</span> is countable then it is a discrete-time stochastic process.</p>
</blockquote>
<blockquote>
<p><strong>Path</strong>: For <span class="math inline">\(\omega\in\Omega\)</span> <strong>fixed</strong> then <span class="math inline">\(t\mapsto \mathrm{X}_t(\omega)\)</span> is a function which we call the path of <span class="math inline">\(\mathrm{X}_t\)</span>.</p>
</blockquote>
<p>In fact, to each <span class="math inline">\(\omega\in\Omega\)</span> there corresponds a function <span class="math inline">\(t\mapsto \mathrm{X}_t(\omega)\)</span>, so that we can put <span class="math inline">\(\Omega\)</span> on a one-to-one correspondence with the space <span class="math inline">\(\mathsf{X}^\mathsf{T}\)</span> of functions from <span class="math inline">\(\mathsf{T}\)</span> to <span class="math inline">\(\mathsf{X}\)</span>.</p>
</div>
